# Spark
스파크 애플리케이션은 드라이버(driver) 프로세스와 다수의 익스큐터(executor) 프로세스로 구성됩니다.
드라이버 프로세스는 main() 함수를 실행하고,
이는 스파크 애플리케이션 정보의 유지 관리, 사용자 프로그램이나 입력에 대한 응답, 전반적인 익스큐터 프로세스의 작업과 관련된 분석, 배포 그리고 스케줄링 역할을 수행하기 때문에 필수적입니다.
드라이버 프로세스는 애플리케이션의 수명 주기 동안 관련 정보를 모두 유지합니다.

익스큐터는 드라이버 프로세스가 할당한 작업을 수행합니다. 즉, 드라이버가 할당한 코드를 실행하고 진행 상황을 다시 드라이버 노드에 보고하는 두 가지 역할을 수행합니다.

## SparkSession
스파크 애플리케이션은 SparkSession이라 불리는 드라이버 프로세스로 제어합니다.
SparkSession 인스턴스는 사용자가 정의한 처리 명령을 클러스터에서 실행합니다.
하나의 SparkSession은 하나의 스파크 애플리케이션에 대응합니다.

## DataFrame
DataFrame은 다양한 데이터 타입의 테이블형 데이터를 보관할 수 있는 Row 타입의 객체로 구성된 분산 컬렉션입니다.
DataFrame은 Row 타입으로 구성된 Dataset입니다.
Row 타입은 스파크가 사용하는 '연산에 최적화된 인메모리 포맷'의 내부적인 표현 방식입니다.
Row 타입을 사용하면 가비지 컬렉션(garbage collection)과 객체 초기화 부하가 있는 JVM 데이터 타입을 사용하는 대신 자체 데이터 포맷을 사용하기 때문에 매우 효율적인 연산이 가능합니다.

컬럼과 컬럼의 타입을 정의한 목록을 스키마 schema라고 부릅니다.
Spark DataFrame은 수천 대의 컴퓨터에 분산되어 있습니다.
단일 컴퓨터에 저장하기에는 데이터가 너무 크거나 계산에 너무 오랜 시간이 걸릴 수 있기 때문입니다.

## Schema
스키마는 DataFrame의 컬럼명과 데이터 타입을 정의합니다.
스키마는 데이터소스에서 얻거나(스키마 온 리드schema-on-read라고 합니다) 직접 정의할 수 있습니다.
비정형 분석(ad-hoc analysis )에서는 스키마-온-리드가 대부분 잘 동작합니다 (단, CSV나 JSON 같은 일반 텍스트 파일을 사용하면 다소 느릴 수 있습니다).
하지만 Long 데이터 타입을 Integer 데이터 타입으로 잘못 인식하는 등 정밀도 문제가 발생할 수 있습니다.
따라서 운영 환경에서는 직접 스키마를 정의해야 합니다.

스키마는 여러 개의 StructField 타입 필드로 구성된 StructType 객체입니다.
StructField는 이름, 데이터 타입, 컬럼이 값이 없거나 null일 수 있는지 지정하는 불리언값을 가집니다.
런타임에 데이터 타입이 스키마의 데이터 타입과 일치하지 않으면 오류를 발생시킵니다.

## Parition
파티션은 모든 익스큐터가 병렬로 작업하기 위해 데이터를 분할하는 데이터 청크의 단위입니다.
파티션은 머신에 존재하는 로우의 집합을 의미합니다.
만약 파티션이 하나라면 스파크에 수천 개의 익스큐터가 있더라도 병렬성은 1이 됩니다.
또한 수백 개의 파티션이 있더라도 익스큐터가 하나밖에 없다면 병렬성은 1이 됩니다.

## Transformation
스파크의 핵심 데이터 구조는 불변성(immutable)을 가집니다. 즉, 한번 생성하면 변경할 수 없습니다.
DataFrame을 '변경'하려면 원하는 변경 방법을 스파크에 알려줘야 합니다. 이때 사용하는 명령을 트랜스포메이션이라 부릅니다.
다음은 '변경'의 예시입니다.
●    로우나 컬럼 추가
●    로우나 컬럼 제거
●    로우를 컬럼으로 변환하거나, 그 반대로 변환
●    컬럼값을 기준으로 로우 순서 변경

액션(action)을 호출하지 않으면 스파크는 실제 트랜스포메이션을 수행하지 않습니다.

좁은 트랜스포메이션은 각 입력 파티션이 하나의 출력 파티션에만 영향을 미칩니다.
넓은 트랜스포메이션은 하나의 입력 파티션이 여러 출력 파티션에 영향을 미칩니다.

## Shuffle
스파크가 클러스터에서 파티션을 교환하는 셔플(shuffle)은 넓은 트랜스포메이션의 과정중에 발생합니다.
스파크는 셔플의 결과를 디스크에 저장합니다

## Action
액션은 사용자가 정의한 일련의 트랜스포메이션으로 생성된 실행계획을 기반하여 최종 결과를 계산하도록 지시하는 명령입니다.

## Lazy execution
지연 연산(lazy evaluation)은 스파크가 연산 그래프를 처리하기 직전까지 기다리는 동작 방식을 의미합니다.
스파크는 트랜스포메이션 명령이 내려진 즉시 데이터를 수정하지 않고 원시 데이터에 적용할 실행 계획을 생성하고, 간결한 물리적 실행 계획으로 컴파일합니다.
스파크는 이 과정을 거치며 전체 데이터 흐름을 최적화합니다.